<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>CodePen - A Pen by KMINALI2005</title>
  <link rel="stylesheet" href="./style.css">

</head>
<body>
<!-- partial:index.partial.html -->
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تطبيق إدارة الديون</title>
<style>
  body { font-family: 'Arial', sans-serif; }
  .container { width: 80%; margin: auto; }
  h2 { text-align: center; }
  form { margin-bottom: 20px; }
  input, button { width: 100%; padding: 10px; margin-top: 5px; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border: 2px solid #756AB6; padding: 10px; text-align: left; }
  th { background-color: #FBF9F1; }
</style>
</head>
<body>
<div class="container">
  <h2>بسم الله الرحمن الرحيم </h2>
   <h2>تطبيق إدارة الديون</h2>
  <form id="debtForm">
    <input type="text" id="clientName" placeholder="اسم العميل" required>
    <input type="number" id="totalOrder" placeholder="الطلب الكلي" required>
    <input type="number" id="amountPaid" placeholder="المبلغ الواصل" required oninput="calculateRemaining()">
    <input type="number" id="amountRemaining" placeholder="المبلغ المتبقي" readonly>
    <input type="date" id="paymentDate" placeholder="تاريخ الواصل" required>
    <button type="submit">حفظ البيانات</button>
    <button type="button" onclick="exportToCSV()">تصدير CSV</button>
  </form>
  <table id="debtTable">
    <thead>
      <tr>
        <th>اسم العميل</th>
        <th>الطلب الكلي</th>
        <th>المبلغ الواصل</th>
        <th>المبلغ المتبقي</th>
        <th>تاريخ الواصل</th>
        <th>تعديل</th>
        <th>حذف</th>
      </tr>
    </thead>
    <tbody>
      <!-- سيتم إضافة الصفوف هنا -->
    </tbody>
  </table>
</div>

<script>
  function calculateRemaining() {
    var totalOrder = document.getElementById('totalOrder').value;
    var amountPaid = document.getElementById('amountPaid').value;
    var amountRemaining = totalOrder - amountPaid;
    document.getElementById('amountRemaining').value = amountRemaining;
  }

  function updateTable() {
    var debts = JSON.parse(localStorage.getItem('debts')) || [];
    var tableBody = document.getElementById('debtTable').getElementsByTagName('tbody')[0];
    tableBody.innerHTML = ''; // إفراغ الجدول
    debts.forEach(function(debt, index) {
      var row = tableBody.insertRow();
      Object.values(debt).forEach(function(text) {
        var cell = row.insertCell();
        cell.textContent = text;
      });
      var editCell = row.insertCell();
      var deleteCell = row.insertCell();
      
      var editButton = document.createElement('button');
      editButton.textContent = 'تعديل';
      editButton.onclick = function() {
        // كود التعديل
      };
      editCell.appendChild(editButton);
      
      var deleteButton = document.createElement('button');
      deleteButton.textContent = 'حذف';
      deleteButton.onclick = function() {
        debts.splice(index, 1); // حذف السجل
        localStorage.setItem('debts', JSON.stringify(debts));
        updateTable(); // تحديث الجدول
      };
      deleteCell.appendChild(deleteButton);
    });
  }

  document.getElementById('debtForm').addEventListener('submit', function(e) {
    e.preventDefault();
    var clientName = document.getElementById('clientName').value;
    var totalOrder = document.getElementById('totalOrder').value;
    var amountPaid = document.getElementById('amountPaid').value;
    var amountRemaining = document.getElementById('amountRemaining').value;
    var paymentDate = document.getElementById('paymentDate').value;
    
    var debts = JSON.parse(localStorage.getItem('debts')) || [];
    debts.push({ clientName, totalOrder, amountPaid, amountRemaining, paymentDate });
    localStorage.setItem('debts', JSON.stringify(debts));
    
    updateTable();
  });

  function exportToCSV() {
    var debts = JSON.parse(localStorage.getItem('debts')) || [];
    var csvContent = "data:text/csv;charset=utf-8,";
    csvContent += "اسم العميل,الطلب الكلي,المبلغ الواصل,المبلغ المتبقي,تاريخ الواصل\r\n"; // عنوان الأعمدة
    debts.forEach(function(debt) {
      var row = Object.values(debt).join(",");
      csvContent += row + "\r\n";
    });

    var encodedUri = encodeURI(csvContent);
    var link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "debts.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  window.onload = updateTable;
</script>
</body>
</html>
<!-- partial -->
  
</body>
</html>
